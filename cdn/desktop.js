(()=>{"use strict";(()=>{const e=JSON.parse('{"u2":{"ja":"年齢自動計算プラグイン"}}').u2.ja,t="ribbit-kintone-plugin",n=e=>e&&(e=>{try{JSON.parse(e)}catch(e){return!1}return!0})(e)&&"object"==typeof e;const r=class{_pluginId;constructor(r){this._pluginId=r;try{(()=>{const r=localStorage.getItem(t),o=n(r)?JSON.parse(r):{};o.pluginNames=o.pluginNames||[],o.pluginNames.includes(e)||o.pluginNames.push(e),localStorage.setItem(t,JSON.stringify(r))})()}catch(e){}}launch=t=>{for(const n of t){const{enables:t=(()=>!0),events:r=["app.record.index.show"],action:o,disableMobile:s=!1}=n,i="function"==typeof r?r(this._pluginId):r,a=s?[]:i.map((e=>"mobile."+e)),c=n=>{try{return t(n)?o(n,this._pluginId):n}catch(t){n.error=`プラグイン「${e}」の処理内でエラーが発生しました。`}return n};kintone.events.on([...i,...a],c)}}},o=e=>{const t=kintone.plugin.app.getConfig(e);return Object.keys(t).length?Object.entries(t).reduce(((e,[t,n])=>({...e,[t]:JSON.parse(n)})),{}):s()},s=()=>({rows:[i()]}),i=()=>({src:"",dst:"",updates:!1}),a={events:["app.record.create.show","app.record.edit.show","app.record.index.edit.show"],action:async(e,t)=>{const n=o(t);if(!n||!n.rows.length)return e;window.AGE_PLUGIN=window.AGE_PLUGIN||{},window.AGE_PLUGIN.initialValues=[];for(const{src:t,dst:r}of n.rows)e.record[r].disabled=!0,window.AGE_PLUGIN.initialValues.push(e.record[t].value);return e}},c={events:["app.record.index.edit.submit","app.record.create.submit","app.record.edit.submit"],action:async(e,t)=>{const n=o(t);if(!n||!n.rows.length||!window.AGE_PLUGIN)return e;for(let t=0;t<n.rows.length;t++){const{src:r,dst:o,updates:s}=n.rows[t],i=window.AGE_PLUGIN.initialValues[t];if(!e.type.includes("record.create")&&!s&&(i||e.record[o].value))continue;const a=e.record[r].value;if(!a){e.record[o].value="";continue}const c=u(new Date(a));e.record[o].value=isFinite(c)?c:NaN}return e}},u=e=>{const t=e.getFullYear(),n=e.getMonth(),r=e.getDate(),o=new Date,s=o.getFullYear(),i=o.getMonth(),a=o.getDate(),c=s-t;return i>n||i===n&&a>=r?c:c-1};var l;l=kintone.$PLUGIN_ID,new r(l).launch([a,c])})()})();