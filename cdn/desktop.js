(()=>{"use strict";const e=kintone.$PLUGIN_ID,t=((()=>{const e=location.pathname.match(/^\/k\/guest\/(\d+)\//);e&&e[1]})(),JSON.parse('{"u2":{"ja":"年齢自動計算プラグイン"}}').u2.ja),n="ribbit-kintone-plugin",r=()=>{const e=(()=>{const e=localStorage.getItem(n);if(!e)return{};try{const t=JSON.parse(e);return"object"==typeof t?t:{}}catch(e){return{}}})();e.pluginNames=e.pluginNames||[],e.pluginNames.includes(t)||e.pluginNames.push(t),localStorage.setItem(n,JSON.stringify(e))};const o=class{_pluginId;constructor(){this._pluginId=e;try{r()}catch(e){}}launch=e=>{for(const n of e){const{enables:e=(()=>!0),events:r=["app.record.index.show"],action:o,disableMobile:s=!1}=n,i="function"==typeof r?r(this._pluginId):r,c=s?[]:i.map((e=>"mobile."+e)),a=n=>{try{return e(n)?o(n,this._pluginId):n}catch(e){n.error=`プラグイン「${t}」の処理内でエラーが発生しました。`,console.error("エラー",e)}return n};kintone.events.on([...i,...c],a)}}},s=e=>{const t=kintone.plugin.app.getConfig(e);return Object.keys(t).length?Object.entries(t).reduce(((e,[t,n])=>({...e,[t]:JSON.parse(n)})),{}):i()},i=()=>({rows:[c()]}),c=()=>({src:"",dst:"",updates:!1}),a={events:["app.record.create.show","app.record.edit.show","app.record.index.edit.show"],action:async(e,t)=>{const n=s(t);if(!n||!n.rows.length)return e;window.AGE_PLUGIN=window.AGE_PLUGIN||{},window.AGE_PLUGIN.initialValues=[];for(const{src:t,dst:r}of n.rows)e.record[r].disabled=!0,window.AGE_PLUGIN.initialValues.push(e.record[t].value);return e}},u={events:["app.record.index.edit.submit","app.record.create.submit","app.record.edit.submit"],action:async(e,t)=>{const n=s(t);if(!n||!n.rows.length||!window.AGE_PLUGIN)return e;for(let t=0;t<n.rows.length;t++){const{src:r,dst:o,updates:s}=n.rows[t],i=window.AGE_PLUGIN.initialValues[t];if(!e.type.includes("record.create")&&!s&&(i||e.record[o].value))continue;const c=e.record[r].value;if(!c){e.record[o].value="";continue}const a=l(new Date(c));e.record[o].value=isFinite(a)?a:NaN}return e}},l=e=>{const t=e.getFullYear(),n=e.getMonth(),r=e.getDate(),o=new Date,s=o.getFullYear(),i=o.getMonth(),c=o.getDate(),a=s-t;return i>n||i===n&&c>=r?a:a-1};(new o).launch([a,u])})();